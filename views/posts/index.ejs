<%- include('../partials/header') %>


<h1>Latest Chirps!</h1>

<% posts.forEach(function(p) { %>
    <div class='user-post'>
        <table class='user-post-table'>
            <td class='user-avatar-td'><img class='user-avatar' src='<%= p.userAvatar %>' alt='avatar' referrerpolicy='no-referrer'></td>
            <td class='username'><%= p.userName %></td>
            <td class='user-content'><%= p.content %></td>
            <td class='drop-down-btn'>
                <% if (user?._id.equals(p.user)) { %>
                    <div class='dropdown' id='dropdown-<%= p._id %>'>
                        <form action='/posts/<%= p._id %>?_method=DELETE' method='POST'>
                            <button type='submit'>
                                <span class="material-symbols-outlined">delete</span>
                            </button>
                        </form>
                        <form id='post-form' action='/posts/<%= p._id %>?_method=PUT' method='POST'>
                            <input id='edit-input' type='text' name='content' value='<%= p.content %>'>
                            <button id='edit-btn' type='submit'>
                                <span class="material-symbols-outlined">edit</span>
                            </button>
                        </form>
                    </div>
                    <button class='dropdown-btn' id='<%= p._id %>'> +
                        <!-- <span class="material-symbols-outlined" id='dropdown-icon-<%= p._id %>'>more_vert</span> -->
                        <!-- <span class="material-symbols-outlined" id='dropdown-icon-<%= p._id %>'>arrow_circle_right</span> -->
                    </button>
                </td>
                <% } %>
                <td><a class='details-link' href='/posts/<%= p._id %>'>details...</a></td>
        </table>
    </div>
<% }); %>

<script>
    document.addEventListener('click', function(e) {
        const targetId = e.target.id
        if (e.target.tagName === 'BUTTON') {
            const dropDownId = `dropdown-${targetId}`
            const dropDownEl = document.getElementById(dropDownId);
            const dropDownVisibility = dropDownEl.style.visibility
            const isHidden = dropDownVisibility === 'hidden' || dropDownVisibility === '';
            dropDownEl.style.visibility = isHidden ? 'visible' : 'hidden';
        }
    });
</script>

<%- include('../partials/footer') %>